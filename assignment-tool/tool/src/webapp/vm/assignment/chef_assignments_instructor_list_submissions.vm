##<!-- $Header: /cvs/sakai2/legacy/tools/src/webapp/vm/assignment/chef_assignments_instructor_list_submissions.vm,v 1.10 2005/06/14 16:07:00 zqian.umich.edu Exp $ -->
<div class="portletBody">
	<div class="navIntraTool">
		#set($prevAction=false)
		#if ($allowAddAssignment)
			#set($prevAction=true)
			<a href="#toolLink("$action" "doNew_assignment")" title="$!tlang.getString("new")">$!tlang.getString("new")</a>
		#end
		#if ($prevAction)
			| 
		#else
			#set($prevAction=true)
		#end
		<a href="#toolLinkParam("$action" "doView" "view=lisofass1")" title="$!tlang.getString('lisofass1')">$!tlang.getString('lisofass1')</a>
		#if ($withGrade && $!allowGradeSubmission)
			#if ($prevAction)
			 | 
			#else
				#set($prevAction=true)
			#end
			<a href="#toolLinkParam("$action" "doView" "view=grarep")" title="$!tlang.getString("gen.grarep")">$!tlang.getString("gen.grarep")</a>
		#end
		#if ($allowAddAssignment)
			#if ($prevAction)
			 | 
			#else
				#set($prevAction=true)
			#end
			#if (!$!view.equals('stuvie'))
				<a href="#toolLinkParam("$action" "doView" "view=stuvie")" title="$!tlang.getString("gen.stuvie")">$!tlang.getString("gen.stuvie")</a>
			#else
				$!tlang.getString("gen.stuvie")
			#end
		#end
		#if (($allowAllGroups) && ($assignmentscheck))
			#if ($prevAction)
			 |
			#else
				#set($prevAction=true)
			#end
			<a href="#toolLink("$action" "doReorder")" title="$tlang.getString('gen.reorder')">$tlang.getString('gen.reorder')</a>
		#end
		#if ($allowUpdateSite)
			#if ($prevAction)
			 | 
			#else
				#set($prevAction=true)
			#end
			<a href="#toolLink("$action" "doPermissions")" title="$tlang.getString('permis')">$tlang.getString('permis')</a>
		#end
	</div>
	<h3>
		$!tlang.getString('submissionsfor') "$assignment.getTitle()"
	</h3>
	#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div class="clear"></div>#end
	<div class="navPanel">
		<div class="viewNav">
				<form name="viewForm" class="inlineForm" method="post" action="#toolForm("AssignmentAction")">
					<input type="hidden" name="eventSubmit_doView_submission_list_option" value="view" />
					<label for="view">
						$tlang.getString("gen.view2")
					</label>
					<span class="skip">$tlang.getString("newassig.selectmessage")</span>
					<select id="view" name="view" size="1" tabindex="3" onchange="blur();document.viewForm.submit();">
						<option value="$tlang.getString('gen.viewallgroupssections')" #if($!view.equals($tlang.getString('gen.viewallgroupssections')))selected="selected"#end >$tlang.getString('gen.viewallgroupssections')</option>
						#foreach($aGroup in $groups)
						<option value="$!aGroup.Reference" #if($!view.equals($!aGroup.Reference))selected="selected"#end >$validator.escapeHtml($aGroup.Title)</option>
						#end
					</select>
				</form>
			</div>
	</div>
	<br />
	#set ($submissionType = $assignment.getContent().getTypeOfSubmission())
	#set ($showMsg = false)
	#set ($showMsg = $!allMsgNumber)
	#if (!$!showMsg || $showMsg ==0)
		<p class="instruction">
			$tlang.getString("theisnostudent")
		</p>
	#else
		<div class="navIntraTool">
			<a href="$accessPointUrl" title="$!tlang.getString('downall')">$!tlang.getString('downall')</a> | 
			#if ($withGrade)
				<a href="#toolLinkParam("$action" "doRelease_grades" "assignmentId=$validator.escapeUrl($!assignment.Reference)")" title="$!tlang.getString('relgrad')">$!tlang.getString('relgrad')</a>
			#else
				<a href="#toolLinkParam("$action" "doRelease_grades" "assignmentId=$validator.escapeUrl($!assignment.Reference)")" title="$!tlang.getString('relcommented')">$!tlang.getString('relcommented')</a>
			#end
			## upload all
			| <a href="#toolLinkParam("$action" "doPrep_upload_all" "assignmentId=$validator.escapeUrl($!assignment.Reference)")" title="$!tlang.getString('uploadall.title')">$!tlang.getString('uploadall.title')</a>
			#if ($taggable)
				#foreach ($provider in $providers)
					#set ($helperInfo = false)
					#set ($helperInfo = $provider.provider.getItemsHelperInfo($activity.Reference))
					#if ($helperInfo)
						| <a href="#toolLinkParam("$action" "doHelp_items" "activityRef=$validator.escapeUrl($activity.Reference)&providerId=$validator.escapeUrl($provider.provider.id)")" title="$!helperInfo.description">$!helperInfo.name</a>
					#end
				#end
			#end
		</div>
		<div class="navPanel">
			#if ($submissionType != 4)
				## only show this for not "non-electronic" type of assignments
				#set($form_action="eventSubmit_doSet_defaultNoSubmissionScore")
				#set($form_label = "non.submission.grade")
			#else
				## assign grade to not graded "non-electronic" submissions
				#set($form_action="eventSubmit_doSet_defaultNotGradedNonElectronicScore")
				#set($form_label="not.graded.non.electronic.submission.grade")
			#end
			<div class="viewNav">
				#set ($gradeType = $assignment.getContent().TypeOfGrade)
				<form name="defaultGradeForm" class="inlineForm" method="post" action="#toolForm($action)">
					<input type="hidden" name="$!form_action" value="setScore" />
					<label for="gradeList">$tlang.getString($!form_label)</label>
					##for non-point-based grading, choose the default grade from drop-down
					#if ($!gradeType != 3)
						<select id="defaultGrade_1" name="defaultGrade" size="1" >
							<option value="">$tlang.getString("non.submission.grade.select")</option>
							#if ($!gradeType == 1)
								<option value="$tlang.getString("gen.nograd")" #if($!defaultGrade && $!defaultGrade.equals($tlang.getString("gen.nograd")))selected="selected"#end>$tlang.getString("gen.nograd")</option>
							#elseif ($!gradeType == 2)
								#foreach ($i in ["ungraded", "A+", "A", "A-","B+","B","B-","C+","C","C-","D+","D","D-","E","F"])
									<option value="$i" #if($!defaultGrade && $!defaultGrade.equals($i))selected="selected"#end>$i</option>
								#end
							#elseif ($!gradeType == 4)
								#foreach ($i in ["ungraded", "pass", "fail"])
									<option value="$i" #if($!defaultGrade && $!defaultGrade.equals($i))selected="selected"#end>$i</option>
								#end
							#elseif ($!gradeType == 5)
								<option value="checked" #if($!defaultGrade && $!defaultGrade.equals($tlang.getString('gen.checked')))selected="selected"#end>$tlang.getString("gen.checked")</option>
							#end
						</select>
					#else
						## instructor needs to type in default points in point-based-grading
						<input type="text" id="defaultGrade_2" name="defaultGrade" value="$!defaultGrade" size="5" />
					#end
					<input type="button" accesskey="a" class="active"  name="apply" value="$tlang.getString('gen.applygrade')" onclick="blur();document.defaultGradeForm.submit();" title="$tlang.getString("gen.applygrade")" />
				</form>
			</div>
			<div class="listNav">
				<div class="instruction">
					$tlang.getString("gen.viewing") $topMsgPos - $btmMsgPos $tlang.getString("gen.of") $allMsgNumber $tlang.getString("gen.items")
				</div>
				#if ($pagesize != 0)
					#if ($goFPButton == "true")
						<form name="firstpageForm" class="inlineForm"  method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_first" value="|&lt;" title="$tlang.getString("gen.first")" />
						</form>
					#else
						<form name="firstpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_first" value="|&lt;" disabled="disabled" />
						</form>
					#end
					#if ($goPPButton == "true")
						<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_prev" value="&lt;" title="$tlang.getString('gen.previous') $pagesize" accesskey="p" />
						</form>
					#else
						<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_prev" value="&lt;" disabled="disabled" />
						</form>
					#end
				#end	
				<form name="pagesizeForm" class="inlineForm" method="post" action="#toolForm("$action")">
					<input type="hidden" name="eventSubmit_doChange_pagesize" value="changepagesize" />
					<label for="selectPageSize" class="skip">$tlang.getString("newassig.selectmessage")</label>
					<select id="selectPageSize" name="selectPageSize" onchange="blur();document.pagesizeForm.submit();">
						#foreach ($i in $!pagesizes)
							<option value="$i" #if($pagesize == $i) selected="selected" #end>$tlang.getString("list.show") $i $tlang.getString("list.itemsper")</option>
						#end
					</select>
				</form>
				#if ($pagesize != 0)
					#if ($goNPButton == "true")
						<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_next" value="&gt;" title="$tlang.getString('gen.next') $pagesize" accesskey="n" />
						</form>
					#else
						<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_next" value="&gt;" disabled="disabled" />
						</form>
					#end
					#if ($goLPButton == "true")
						<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_last" value=">&gt;" title="$tlang.getString('gen.last')" />
						</form>
					#else
						<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="submit" name="eventSubmit_doList_last" value=">&gt;" disabled="disabled" />
						</form>
					#end
				#end
			</div>
		</div>
		<form name= "listSubmissionsForm" action="#toolForm("AssignmentAction")" method="post">
			<input type="hidden" name="assignmentId" value="$assignment.Reference" />
			## show all submissions
			<table class="listHier lines nolines" cellpadding="0" cellspacing="0" summary="$tlang.getString("gen.viewassliststudentsummary")">
				<tr> 
					<th id="attachment" class="attach">
						&nbsp;
					</th>
					<th id="studentname">
						<a href="#" onclick="location='#toolLinkParam("AssignmentAction" "doSort_grade_submission" "criteria=$!sort_lastName")'; return false;"   title="$tlang.getString("gen.sorbylas")">
							$tlang.getString("gen.student")
							#if ($sortedBy.equals($!sort_lastName)) 
								#if ($sortedAsc.equals("true")) 
									<img id="sortascendinglastname" src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString("gen.sorasc")" /> 
								#else 
									<img id="sortdescendinglastname" src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString("gen.sordes")" /> 
								#end 
							#end 
						</a>
					</th>
					<th id="submitted">
						<a href="#" onclick="location='#toolLinkParam("AssignmentAction" "doSort_grade_submission" "criteria=$!sort_submitTime")'; return false;"  title="$tlang.getString("listsub.sorbysub")">
							$tlang.getString("gen.subm4")
							#if ($sortedBy.equals($!sort_submitTime)) 
								#if ($sortedAsc.equals("true")) 
									<img id="sort_ascending_submittime" src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString("gen.sorasc")" /> 
								#else 
									<img id="sort_descending_submit_time" src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString("gen.sordes")" /> 
								#end 
							#end 
						</a>
					</th>
					<th id="status">
						<a href="#" onclick="location='#toolLinkParam("AssignmentAction" "doSort_grade_submission" "criteria=$!sort_submitStatus")'; return false;"  title="$tlang.getString("listsub.sorbysta")">
							$tlang.getString("gen.status")
							#if ($sortedBy.equals($!sort_submitStatus)) 
								#if ($sortedAsc.equals("true")) 
									<img id="sort_ascending_status" src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString("gen.sorasc")" /> 
								#else 
									<img id="sort_descending_status" src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString("gen.sordes")" /> 
								#end 
							#end 
						</a>
					</th>
					#if ($withGrade)
						<th id="grade">
							<a href="#" onclick="location='#toolLinkParam("AssignmentAction" "doSort_grade_submission" "criteria=$!sort_submitGrade")'; return false;"  title="$tlang.getString("gen.sorbygra")">
								$tlang.getString("gen.gra")
								#if ($sortedBy.equals($!sort_submitGrade)) 
									#if ($sortedAsc.equals("true")) 
										<img id="sort_ascending_grade" src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString("gen.sorasc")" /> 
									#else 
										<img id="sort_descending_grade" src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString("gen.sordes")" /> 
									#end 
								#end 
							</a>
						</th>
					#end	
					#if ($allowReviewService && $assignment.getContent().AllowReviewService)
						<th id="reviewService">
							<a href="#" onclick="location='#toolLinkParam("AssignmentAction" "doSort_grade_submission" "criteria=$!sort_submitReview")'; return false;" onkeypress="location='#toolLinkParam("AssignmentAction" "doSort_grade_submission" "criteria=$!sort_submitReview")'; return false;" title="$tlang.getString("gen.sorbyreview")">
								$tlang.getString("gen.rev")
								#if ($sortedBy.equals($!sort_submitReview)) 
									#if ($sortedAsc.equals("true")) 
										<img id="sort_ascending_review" src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString("gen.sorasc")" /> 
									#else 
										<img id="sort_descending_review" src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString("gen.sordes")" /> 
									#end 
								#end 
							</a>
						</td>
					#end
					<th id="gradereleased">
						<a href="#" onclick="location='#toolLinkParam("AssignmentAction" "doSort_grade_submission" "criteria=$!sort_submitReleased")'; return false;"  title="$tlang.getString("listsub.sorbyrel")">
							$tlang.getString("gen.relea")
							#if ($sortedBy.equals($!sort_submitReleased)) 
								#if ($sortedAsc.equals("true")) 
									<img id="sort_ascending_released" src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString("gen.sorasc")" /> 
								#else 
									<img id="sort_descending_released" src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString("gen.sordes")" /> 
								#end 
							#end 
						</a>
					</th>
				</tr>
				#foreach ($userSubmission in $userSubmissions)
					#set($submission=false)
					#set($submission = $userSubmission.Submission)
					#set($siteUser=false)
					#set($siteUser = $userSubmission.User)
					#set($submitterName=$!siteUser.sortName)
					#set($submitterId=$!siteUser.getDisplayId())
					#if ($!submitterId)
						##attach the displayId
						#set($submitterName=$submitterName.concat("(").concat($submitterId).concat(")"))
					#end
					#set($submitTime=false)
					#set($returnedTime=false)
					#if ($!submission)## && $submission.submitted) 
						#set($returnedTime = $submission.getTimeReturned())
						#set($submitTime = $submission.getTimeSubmitted())
						<tr> 
							<td headers="attachment" class="attach">
								#set ($attachments = $!submission.SubmittedAttachments)
								#set ($size = 0)
								#set ($props = false)
								#if (!$!attachments.isEmpty())
									#set ($attachment = $attachments.next())
									#set ($props = $attachment.Properties) 
									#if ($!props)
										#set ($size = $size + 1)
									#end
								#end 
								#if ($size > 0)
									<img src="#imageLink("sakai/attachments.gif")" border="0" alt="$tlang.getString("gen.att")" width="15" height="15" />
								#end
							</td>
							<td headers="studentname">
								#if ($taggable)
									#if (!$!submission.submitted)
										#set($submittedText = $!submission.submittedText)
										#set($submittedAttachments = $submission.submittedAttachments)
										#if ($!submittedText.length() > 0 || $!submittedAttachments.size() > 0 )
										<span class="highlight">$tlang.getString("gen.dra2") </span>
										#end
									#end
									$submitterName
									<div class="itemAction">
										<a href="#toolLinkParam("AssignmentAction" "doGrade_submission" "assignmentId=$validator.escapeUrl($assignment.Reference)&submissionId=$validator.escapeUrl($submission.Reference)")" title="$tlang.getString("listsub.grasub")">$!tlang.getString("listsub.grade")</a>
										#foreach ($provider in $providers)
											#set ($item = $producer.getItem($submission, $siteUser.getId()))
											#set ($helperInfo = false)
											#set ($helperInfo = $provider.provider.getItemHelperInfo($item.reference))
											#if ($helperInfo)
												| <a href="#toolLinkParam("$action" "doHelp_item" "itemRef=$validator.escapeUrl($item.reference)&providerId=$validator.escapeUrl($provider.provider.id)")" title="$!helperInfo.description">$!helperInfo.name</a>
											#end
										#end
									</div>
								#else
									<a href="#toolLinkParam("AssignmentAction" "doGrade_submission" "assignmentId=$validator.escapeUrl($assignment.Reference)&submissionId=$validator.escapeUrl($submission.Reference)")" title="$tlang.getString("listsub.grasub")">
										#if (!$!submission.submitted)
											#set($submittedText = $!submission.submittedText)
											#set($submittedAttachments = $submission.submittedAttachments)
											#if ($!submittedText.length() > 0 || $!submittedAttachments.size() > 0 )
											<span class="highlight">$tlang.getString("gen.dra2") </span>
											#end
										#end
										$submitterName
									</a>
								#end
							</td>
							<td headers="submitted">
									#if ($!submission)
										#if($!submitTime)$submitTime.toStringLocalFull()#end
										#if ($!submitTime && $submitTime.after($assignment.DueTime))
											<span class="highlight">$tlang.getString("gen.late2")</span> 
										#end
									#else
										$tlang.getString("listsub.nosub")
									#end
							</td>
							<td headers="status">
								$submission.getStatus()
							</td>
							#if ($withGrade)
								<td headers="grade">
									$submission.getGradeDisplay()
								</td>
							#end	
							#if ($allowReviewService && $assignment.getContent().AllowReviewService)
								<td headers="reviewService">
								 #if ($submission.getReviewScore() == -1 || $submission.getReviewScore() == -2)
								 	$tlang.getString("review.noreport")
								 #else
								 <a href="$submission.getReviewReport()" target="_blank" title="View report: score $submission.getReviewScore()">
								 <img src="$submission.getReviewIconUrl()" alt="$submission.getReviewScore()">
								 </a>
								 #end
									
								</td>
							#end
							<td headers="gradereleased">
								#if ($submission.getGradeReleased())
									<img src="#imageLink("sakai/checkon.gif")" alt="$tlang.getString("gen.opecli")" border="0" width="17" height="13" align="top" />
								#else
									<img src="#imageLink("sakai/checkoff.gif")" alt="$tlang.getString("gen.opecli")" border="0" width="15" height="15" align="top" />
								#end
							</td>
						</tr>
					#else
						## no submission for the user yet
						<tr> 
							<td headers="attachment" class="attach">
								&nbsp;
							</td>
							<td headers="studentname">
								$!siteUser.sortName
							</td>
							<td headers="submitted">
								&nbsp;
							</td>
							<td headers="status">
								$tlang.getString("status.noSubmission")
							</td>
							#if ($withGrade)
								<td headers="grade">
									&nbsp;
								</td>
							#end
							<td headers="gradereleased">
								&nbsp;
							</td>
						</tr>
					#end
				#end
			</table>
		</form>
	#end
	<hr class="itemSeparator" />
	<h3>$tlang.getString("gen.assdet")</h3>
	<table class="itemSummary" border="0" cellspacing="0" summary="$tlang.getString("gen.theassinf2")">
		<tr> 
			<th>
				$tlang.getString("gen.asstit")
			</th>
			<td>
				$validator.escapeHtml($assignment.title)
			</td>
		</tr>
		<tr>
			<th>
				$tlang.getString("gen.creby")
			</th>
			<td>
				$userDirectoryService.getUser($assignment.getCreator()).DisplayName ($assignment.TimeCreated.toStringLocalFull())
			</td>
		</tr>
		<tr>
			<th>
				$tlang.getString("gen.mod")
			</th>
			<td>
				$assignment.TimeLastModified.toStringLocalFull()
			</td>
		</tr>
		<tr> 
			<th>
				$tlang.getString("gen.open2")
			</th>
			<td>
				$assignment.OpenTime.toStringLocalFull()
			</td>
		</tr>
		<tr> 
			<th>
					$tlang.getString("gen.due2")
			</th>
			<td>
				$assignment.DueTime.toStringLocalFull()
			</td>
		</tr>
		#set ($closeDate = $assignment.getCloseTime())
		#if ($!closeDate)
			<tr> 
				<th>
					$tlang.getString("gen.acesubunt")
				</th>
				<td>
					$assignment.CloseTime.toStringLocalFull()
				</td>
			</tr>
		#end
		<tr> 
			<th>
				$tlang.getString("gen.stusub2")
			</th>
			<td>
				$submissionTypeTable.get($submissionType)
			</td>
		</tr>
		<tr valign="top"> 
			<th>
				$tlang.getString("gen.grasca")
			</th>
			<td>
				## get gradeScale
				#set ($gradeScale = $assignment.getContent().getTypeOfGradeString($assignment.getContent().getTypeOfGrade()))
				$gradeScale
				#if ($!gradeType == 3)
					($tlang.getString("grade.max") $assignment.getContent().getMaxGradePointDisplay())
				#end
			</td>
		</tr>
		<tr> 
			<th>
				$tlang.getString("gen.honple")
			</th>
			<td> 
				#if ($assignment.getContent().HonorPledge == 1)
					$tlang.getString("gen.no")
				#else
					$tlang.getString("gen.yes")
				#end
			</td>
		</tr>
	</table>	

	#if ($assignment.getContent().getInstructions().length()==0)
	#else
		<h4>$tlang.getString("gen.assinf")</h4>
		<div class="textPanel">$validator.escapeHtmlFormattedText($assignment.getContent().getInstructions())</div>
	#end
	#set ($size = 0)
	#set ($attachments = $assignment.getContent().Attachments)
	#set ($props = false)
	#foreach ($attachment in $attachments) 
		#set ($props = $attachment.Properties) 
		#if ($!props)
			#set ($size = $size + 1)
		#end
	#end
	#if ($size == 0)
	#else
		<h4>$tlang.getString("gen.addres")</h4>
		<ul class="attachList indnt1">
			#foreach ($attachment in $attachments) 
				#set ($props = false)
				#set ($props = $attachment.Properties) 
				#if ($!props)
					<li>
						#if ($props.getBooleanProperty($props.NamePropIsCollection))
							<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
						#else
							<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
						#end
						<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
						#if (!$props.getBooleanProperty($props.NamePropIsCollection))
							($props.getPropertyFormatted($props.NamePropContentLength))
						#end
					</li>
				#end
			#end
		</ul>
	#end
	#if ($taggable)
	   	#parse ("/vm/assignment/chef_assignments_tags_list.vm")
	#end	
</div>
