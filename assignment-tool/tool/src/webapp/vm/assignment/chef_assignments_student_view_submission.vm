<style type="text/css">
	.toggleAnchor{
		border:1px solid #cef;
		background:#cef url(/library/image/sakai/expand.gif) 5px no-repeat !important;
		padding:5px 5px 5px 25px !important;
		cursor:pointer
	}
	.toggleAnchor:hover,	.toggleAnchorOpen:hover{
		border:1px solid #9cf;
	}

	.toggleAnchorOpen{
		border:1px solid #cef;
		background:#cef url(/library/image/sakai/collapse.gif) 5px no-repeat !important;
		padding:5px 5px 5px 25px !important;
		cursor:pointer
	}
	.toggledContent{
		margin:0;
		border:2px solid #cef;
		border-top:none;
		padding: 1em
	}
	.toggledContent h4{
		color:#000 !important;
		width:40em;
		margin:.5em 0 !important;
		padding:.3em 0;
		border-bottom:2px solid #ccc
	}

</style>

<script type="text/javascript" src="/library/js/jquery.js"></script>
<script type="text/javascript">
 $(document).ready(function(){
 	// toggle a fade
 	jQuery.fn.fadeToggle = function(speed, easing, callback) {
   return this.animate({opacity: 'toggle'}, speed, easing, callback);
}; 
$('.inlinecoms').hide();
$('.gencoms').hide();
$('.attachcoms').hide();
$('.gradecoms').hide();

$('#toggleInline').click(function(){
	$('.inlinecoms').fadeToggle();
	if ($('#toggleInline').is('.toggleAnchor')){
		$('#toggleInline').removeClass('toggleAnchor')
		$('#toggleInline').addClass('toggleAnchorOpen')
		}
	else {
		$('#toggleInline').removeClass('toggleAnchorOpen')
			$('#toggleInline').addClass('toggleAnchor')
	}	

  resizeFrame('grow');
	return false;
});
// toggle the previous feedback text
$('#toggleGen').click(function(){
$('.gencoms').fadeToggle();
if ($('#toggleGen').is('.toggleAnchor')){
	$('#toggleGen').removeClass('toggleAnchor')
	$('#toggleGen').addClass('toggleAnchorOpen')
	}
else {
	$('#toggleGen').removeClass('toggleAnchorOpen')
		$('#toggleGen').addClass('toggleAnchor')
	}	
 resizeFrame('grow');
 	return false;
});
// toggle the previous attachment list
$('#toggleAttach').click(function(){
	$('.attachcoms').fadeToggle();
	if ($('#toggleAttach').is('.toggleAnchor')){
		$('#toggleAttach').removeClass('toggleAnchor')
		$('#toggleAttach').addClass('toggleAnchorOpen')
		}
	else {
		$('#toggleAttach').removeClass('toggleAnchorOpen')
			$('#toggleAttach').addClass('toggleAnchor')
	}	
  resizeFrame('grow');
	return false;
});
// toggle the previous grade
$('#toggleGrade').click(function(){
	$('.gradecoms').fadeToggle();
	if ($('#toggleGrade').is('.toggleAnchor')){
		$('#toggleGrade').removeClass('toggleAnchor')
		$('#toggleGrade').addClass('toggleAnchorOpen')
		}
	else {
		$('#toggleGrade').removeClass('toggleAnchorOpen')
			$('#toggleGrade').addClass('toggleAnchor')
	}	
  resizeFrame('grow');
	return false;
});
});
//this function needs jquery 1.1.2 or later - it resizes the parent iframe without bringing the scroll to the top
	function resizeFrame(updown) 
	{
		if (top.location != self.location) 	 {
			var frame = parent.document.getElementById(window.name);
		}	
			if( frame ) 
		{
			if(updown=='shrink')
			{
				var clientH = document.body.clientHeight - 30;
			}
			else
			{
				var clientH = document.body.clientHeight + 30;
			}
			$( frame ).height( clientH );
		} 
		else 
		{
			throw( "resizeFrame did not get the frame (using name=" + window.name + ")" );
		}
	}

</script>
<div class="portletBody">
## submission times
	#set($timeReturned=false)
	#set($timeReturned=$submission.TimeReturned)
	#set($timeSubmitted=false)
	#set($timeSubmitted=$submission.TimeSubmitted)
	#set($submitted=false)
	#set($submitted=$submission.getSubmitted())
	#set($returned=false)
	#set($returned=$submission.getReturned())
	#set($closeTime = false)
	#set($closeTime = $assignment.CloseTime)
	#if ($!submission)
		##override the close time setting for assignment by submission's individual setting
		#set($closeTime = $submission.CloseTime)
	#end
	#set ($submissionType = $assignment.getContent().getTypeOfSubmission())
	#if (!$!canSubmit)
		<div class="alertMessage">$tlang.getString("stuviewsubm.theclodat")</div><div class="clear"></div>
	#else
		#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div class="clear"></div>#end
		#if ($!submission && $timeSubmitted)
			## if there is a submitted submission
			## get the properies
			#if ($!allowAddAssignment)
				<h3>$tlang.getString("viewexampleassign") </h3>
			#else
			<h3>
				#if(!$submitted)
					## draft submission
##					$tlang.getString("viewassign")
					## no need to show status if this is for an non-electronic submission type of assignment
				 #if (!$!nonElectronicType)
##						<span class="highlight">
##						 	- $tlang.getString("gen.inpro")
##						</span>
					#end
				#end
				#if ($!timeReturned && $!timeSubmitted && $!timeReturned.after($!timeSubmitted))
				$validator.escapeHtml($assignment.getTitle())
					<span class="highlight">
						 - $tlang.getString("resubmit")
					</span>
				#end	
				</h3>
			#end
			#if ($returned)
					#if ($!timeSubmitted && $!timeReturned && $!timeReturned.after($!timeSubmitted))
					<p class="instruction">
						$tlang.getString("stuviewsubm.asshasbee4") $submission.TimeReturned.toStringLocalFull(). $tlang.getString("stuviewsubm.plesub")
					</p>	
					#else
					<p class="instruction">
						$tlang.getString("stuviewsubm.asshasbee3") $submission.TimeSubmitted.toStringLocalFull().
						#if ($!timeSubmitted && $!timeSubmitted.after($assignment.DueTime))
							<span class="highlight"> $tlang.getString("gen.late")</span>
						#end
					</p>	
					#end
			#elseif ($submission.getGraded() && ($submission.getGradeReleased() || $returned))
					$tlang.getString("stuviewsubm.asshasbee2")
			#else
					<p class="instruction">$tlang.getString("gen.hasbee") $submission.TimeSubmitted.toStringLocalFull()</p>
					#if ($!timeSubmitted && $!timeSubmitted.after($assignment.DueTime))
						<span class="highlight"> $tlang.getString("gen.late")</span>
					#end
			#end
		#else
			#if ($!allowAddAssignment)
				<h3>$tlang.getString("subexampleassign")</h3>
			#else 
				<h3>$tlang.getString("gen.assig")
					## no need to show status if this is for an non-electronic submission type of assignment
					#if (!$!nonElectronicType)
							<span class="highlight">
						aaaa 	- $tlang.getString("gen.inpro")
							</span>
						#end
				</h3>
			#end
			## TEXT_ONLY_ASSIGNMENT_SUBMISSION = 1;
			## ATTACHMENT_ONLY_ASSIGNMENT_SUBMISSION = 2;
			## TEXT_AND_ATTACHMENT_ASSIGNMENT_SUBMISSION = 3;
			## NON_ELECTRONIC_ASSIGNMENT_SUBMISSION = 4;
			<p class="instruction">
				#if (($submissionType==1) || ($submissionType==3))
					 $tlang.getString("stuviewsubm.asshasnot")
				#elseif ($submissionType==2)
				 	$tlang.getString("stuviewsubm.assattonly")
				#end
			</p>	
		#end
	#end
##		<h4>$tlang.getString("gen.assdet")</h4>
			<table class="itemSummary"  summary="$tlang.getString("gen.theassinf")">
				<tr>
					<th>
						$tlang.getString("gen.tit2")
					</th>
					<td>
						$validator.escapeHtml($assignment.getTitle())
						#set ($deleted = false)
						#set ($deleted = $assignment.getProperties().getProperty($assignment.getProperties().getNamePropAssignmentDeleted()))
						#if ($!deleted.equalsIgnoreCase("true"))
							<span class="highlight">(Assignment has been deleted)</span>
						#end
					</td>
				</tr>
				<tr>
					<th>
						$tlang.getString("gen.due2")
					</th>
					<td>
						$!assignment.getDueTime().toStringLocalFull()
					</td>
				</tr>
				## no need to show status if this is for an non-electronic submission type of assignment
					#if (!$!nonElectronicType)
				<tr>
					<th>
						$tlang.getString("gen.status2")
					</th>
					<td>
						#if ($!submission)
							#if ($submitted && $!timeSubmitted)
								#if ($returned)
									#if ($!timeReturned && $!timeSubmitted && $!timeReturned.after($!timeSubmitted))
										$tlang.getString("gen.retu") $submission.TimeReturned.toStringLocalFull()
									#else
										$tlang.getString("gen.resub") $submission.TimeSubmitted.toStringLocalFull()
										#if ($!timeSubmitted && $!timeSubmitted.after($assignment.DueTime))
											<span class="highlight"> $tlang.getString("gen.late")</span>
										#end
									#end
								#elseif ($submission.getGraded() && $submission.getGradeReleased())
									#if ($!withGrade)
										$tlang.getString("grad3")
									#else
										$tlang.getString("gen.commented")
									#end
								#else
									$tlang.getString("gen.subm4") $submission.timeSubmitted.toStringLocalFull()
									#if ($!timeSubmitted && $!timeSubmitted.after($assignment.DueTime))
										<span class="highlight">$tlang.getString("gen.late2")</span>
									#end
								#end
							#else
								$tlang.getString("gen.inpro")
							#end
						#else
							$tlang.getString("gen.notsta")
						#end
					</td>
				</tr>
				#end				
				#if ($withGrade)
					#set ($gradeScale = $assignment.getContent().getTypeOfGradeString($assignment.getContent().getTypeOfGrade()))
					#if ($submission.getGraded() && $submission.getGradeReleased())
						<tr>	
							<th>
								$tlang.getString("gen.gra3")
							</th>
							<td class="highlight">
								<strong>
									#if ($assignment.getContent().TypeOfGrade != 1)
										$submission.GradeDisplay
									#else
										$tlang.getString("gen.nograd")
									#end
									#if ($gradeScale == "Points")
										(max $assignment.getContent().getMaxGradePointDisplay())
									#end
								</strong>
							</td>
						</tr>
					#else
						<tr>	
							<th>
								$tlang.getString("gen.grasca")
							</th>
							<td>
								$gradeScale
								#if ($gradeScale == "Points")
									(max $assignment.getContent().getMaxGradePointDisplay())
								#end
							</td>
						</tr>
					#end
				#end
				##show alert when assignment is modified and the modified date is after its open date	
				#set($newAssignment="false")
				#set($newAssignment=$assignment.getProperties().getProperty("newAssignment"))
				#if ($assignment.getTimeLastModified().after($assignment.getOpenTime()) && !$!newAssignment.equalsIgnoreCase("true"))
					<tr>
						<th>
								$tlang.getString("gen.modbyins")
						</th>
						<td>
							$assignment.getTimeLastModified().toStringLocalFull()
						</td>
					</tr>
				#end
			</table>
		<h4>
			$tlang.getString("gen.assinfshort")
		</h4>
		
		#if ($!assignment.getContent().getInstructions().length()>0)
			<div class="textPanel">$validator.escapeHtmlFormattedText($!assignment.getContent().getInstructions())</div>
		#else
		#end

		#set ($size = 0)
		#set ($props = false)
		#foreach ($attachment in $assignment.getContent().getAttachments()) 
			#set ($props = $attachment.Properties) 
			#if ($!props)
				#set ($size = $size + 1)
			#end
		#end
		#if ($size > 0)
			<h4>
				$tlang.getString("gen.addres2")
			</h4>	
				<ul class="attachList indnt1">
					#foreach ($attachment in $assignment.getContent().getAttachments()) 
						#set ($props = false)
						#set ($props = $attachment.Properties) 
						#if ($!props)
							<li>
								#if ($props.getBooleanProperty($props.NamePropIsCollection))
									<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
								#else
									<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
								#end
									<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
								#if (!$props.getBooleanProperty($props.NamePropIsCollection))
									($props.getPropertyFormatted($props.NamePropContentLength))
								#end
							</li>
						#end
					#end
				</ul>
				##end
		#end
		#if ($taggable)
        	#parse ("/vm/assignment/chef_assignments_tags_list.vm")
		#end
		<hr class="itemSeparator" />
		#if ($returned)
			<h3>$tlang.getString("gen.resubmission")</h3> 
		#else
				<h3>$tlang.getString("gen.submission")</h3> 
		#end	



		## show special instruction if this is for an non-electronic submission type of assignment
		#if ($!nonElectronicType)
			<p class="instruction">
				$tlang.getString("nonelec_instruction")
			</p>
			##just show a simple done button for non-electronic submission type
			<form name="dummyForm" action="#toolForm("AssignmentAction")" method="post" onsubmit="return true;">
				<input type="submit" accesskey="x" name="eventSubmit_doCancel_show_submission" value="$tlang.getString('gen.don')" />
			</form>
		#else
	<form name="addSubmissionForm" action="#toolForm("AssignmentAction")" method="post" onsubmit="return true;">
		<input type="hidden" name="eventSubmit_doRead_add_submission_form" value="x" />
		<input type="hidden" name="option" value="cancel" />
		<input type="hidden" name="assignmentId" value="$assignment.Reference" />
		#if ($!canSubmit)
			## if a draft submission or the submission has been returned and has not yet submitted
			## 1- text only; 2-attachment only; 3-text and attachment
			#set ( $submissionType = $assignment.getContent().getTypeOfSubmission())
			#if (($submissionType==1) || ($submissionType==3))
				#if ($!deleted.equalsIgnoreCase("true"))
					<h4>$tlang.getString("gen.yousub") </h4>
					##if the assignment has been deleted, disable the action button
					$validator.escapeHtmlFormattedText($!value_submission_text)
				#else
					#*
					#if (!$submitted || ($submitted && !$timeSubmitted))
						## for draft submission
						#if ($!closeTime && $currentTime.after($closeTime))
							##disable input for submitted and not returned submission or when later than assignment close date
							##<h4>$tlang.getString("gen.yousub")</h4>
							$validator.escapeHtmlFormattedText($!value_submission_text)
						#else*#
							<h4>$tlang.getString("assignmenttext")</h4>
							<p class="instruction">
							#if ($returned)
									$tlang.getString("stuviewsubm.entbelo")
							#else
								#if ($submissionType==1)
									$tlang.getString("gen.theassall6")
								#elseif ($submissionType==3)
									$tlang.getString("gen.theassall4")
								#end
							#end
							</p>
							<table border="0" summary="layout">
								<tr>
									<td>
										<textarea cols="80" rows="30" wrap="virtual" name="$name_submission_text" id="$name_submission_text" #if(!$allowSubmit)disabled="disabled"#end >#if($!value_submission_text)$validator.escapeHtmlFormattedTextarea($!value_submission_text)#end</textarea>						
											#chef_setupformattedtextarea($name_submission_text)
									</td>
								</tr>
							</table>
						## feedback text
						#set($feedbackText = false)
						#set($feedbackText = $submission.FeedbackText)
						#if ($!feedbackText && $feedbackText.length()>0)
							#if ($!prevFeedbackText)
								<h3>$tlang.getString("gen.orisub3")</h3>							
							#else
								<h3>$tlang.getString("gen.orisub2")</h3>
							#end
						<div class="textPanel">
							$cheffeedbackhelper.escapeAssignmentFeedback($feedbackText)
						</div>
						#end
						## for returned submission, show the instructor commented text as well
						#if ($!prevFeedbackText)
							<h4 id="toggleInline" class="toggleAnchor">$tlang.getString("gradingsub.prefeetex3")</h4>
							<div class="inlinecoms toggledContent">
								$cheffeedbackhelper.showPrevFeedback($cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackText))
							</div>
						#end
						#*#else
							## for resubmitted submission, show the input disabled
							<div>
								$tlang.getString("gen.yousub")
							</div>
							$validator.escapeHtmlFormattedText($!value_submission_text)
						#end							
					#end*#
				#end
			#end
			#if (($submissionType==2) || ($submissionType==3)) 
				#if ($submissionType==2)
					<p class="instruction">
						#if (($submitted && !$returned) || ($returned && $!timeReturned && $!timeSubmitted && $!timeReturned.before($!timeSubmitted)) || ($!closeTime && $currentTime.after($closeTime)))
							## for submitted not yet returned submission; or returned by resubmitted submission; or after close date
							$tlang.getString("stuviewsubm.youatt")
						#else
							$tlang.getString("stuviewsubm.theassall2")
						#end
					</p>
				#end	
				<h3>
					$tlang.getString("gen.stuatt") 
				</h3>	
					#set ($size = 0)
					#set ($props = false)
					#foreach ($attachment in $attachments) 
						#set ($props = $attachment.Properties) 
						#if ($!props)
							#set ($size = $size + 1)
						#end
					#end
					#if ($size == 0)
						<p class="instruction">$tlang.getString("gen.noatt")</p>
					#else
						<ul class="attachList indnt1">
							#foreach ($attachment in $attachments) 
								#set ($props = false)
								#set ($props = $attachment.Properties) 
								#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										#if (!$props.getBooleanProperty($props.NamePropIsCollection))
											($props.getPropertyFormatted($props.NamePropContentLength))
										#end
									</li>
								#end
							#end
						</ul>
					#end	 
					<p class="act">
						#if ($!deleted.equalsIgnoreCase("true"))
							##if the assignment has been deleted, disable the action button
							<input type="submit" name="eventSubmit_doAttachments" value="Attachment" accesskey="a" disabled="disabled" />
						#else
							##if the submission has not been submitted or has been returned and not yet resubmitted
							#if (!$submitted || ($submitted && !$timeSubmitted) || ($returned && $!timeSubmitted && $!timeReturned && $!timeReturned.after($!timeSubmitted)))
								#if ($!closeTime)
									## there is close date. Can only submit before the close date
									#if ($currentTime.before($!closeTime))
										<input
											class="disableme" 
											type="button" 
											name="attach" 
											id="attach"
											#if ($size==0) 
												value="$tlang.getString("gen.addatt")"
											#else
												value="$tlang.getString("gen.adddroatt2")"
											#end
											accesskey="a" #if(!$allowSubmit)disabled="disabled"#end
											onclick="document.addSubmissionForm.onsubmit();document.addSubmissionForm.option.value='attach'; document.addSubmissionForm.submit(); return false;"
										/>
									#end
								#else
									## there is no close date. Still can submit after due date
									<input
										class="disableme" 
										type="button" 
										name="attach" 
										id="attach"
										#if ($size==0) 
											value="$tlang.getString("gen.addatt")"
										#else
											value="$tlang.getString("gen.adddroatt2")"
										#end
										accesskey="a" #if(!$allowSubmit)disabled="disabled"#end
										onclick="document.addSubmissionForm.onsubmit();document.addSubmissionForm.option.value='attach'; document.addSubmissionForm.submit(); return false;"
									/>										
								#end
							#end
						#end
					</p>
				#end
				#if ($returned && $!timeReturned && ($!timeSubmitted && $!timeReturned && $!timeReturned.after($!timeSubmitted) || !$!timeSubmitted))
					#if (($!submission.FeedbackComment) && ($submission.FeedbackComment.trim().length()>0))
						#if ($submissionType==2)
							<h3>$tlang.getString("gen.addinst2")</h3>
						#else
							<h3>$tlang.getString("gen.addinst")</h3>
						#end	
							<div class="textPanel">$validator.escapeHtmlFormattedText($submission.FeedbackComment)</div>
						#else
					#end
					## for returned (not resubmitted ) submission, show the instructor feedback
					#if ($!prevFeedbackComment && $!prevFeedbackComment.trim().length() > 0)
							<h4  id="toggleGen" class="toggleAnchor">
								$tlang.getString("gradingsub.prefee2")
								</h4>
					<div class="gencoms toggledContent">					
						$cheffeedbackhelper.showPrevFeedback($cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackComment))</div>
					#end					
					#set ($size = 0)
					#set ($props = false)
					#set ($feedbackAttachments = $submission.FeedbackAttachments)	
					#set ($size = 0)
					#set ($props = false)
					#foreach ($attachment in $feedbackAttachments) 
						#set ($props = $attachment.Properties) 
						#if ($!props)
							#set ($size = $size + 1)
						#end
					#end
					#if ($size == 0)
						##$tlang.getString("gen.noatt")
					#else
						<h4>$tlang.getString("gen.addinstatts")</h4>
						<ul class="attachList indnt1">
							#foreach ($attachment in $feedbackAttachments) 
								#set ($props = false)
								#set ($props = $attachment.Properties) 
								#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										#if (!$props.getBooleanProperty($props.NamePropIsCollection))
											($props.getPropertyFormatted($props.NamePropContentLength))
										#end
									</li>
								#end
							#end
						</ul>
					#end
					## show previous grading/feedback attachments if any
					#if ($!prevFeedbackAttachments && $prevFeedbackAttachments.size()>0)
						## show previous grading/feedback attachments if any
						<h4 id="toggleAttach" class="toggleAnchor">
							$tlang.getString("gradingsub.prefeedbackAttachments")
						</h4>
						<div class="attachcoms  toggledContent">
						#set ($size = 0)
						#set ($props = false)
						#foreach ($attachment in $!prevFeedbackAttachments) 
							#set ($props = $attachment.Properties) 
							#if ($!props)
								#set ($size = $size + 1)
							#end
						#end
						#if ($size == 0)
							<p class="instruction">$tlang.getString("gen.noatt")</p>
						#else
							<ul class="attachList indnt1">
								#foreach ($attachment in $!prevFeedbackAttachments) 
									#set ($props = false)
									#set ($props = $attachment.Properties) 
									#if ($!props)
										<li>
											#if ($props.getBooleanProperty($props.NamePropIsCollection))
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
											#else
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
											#end
											<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
											#if (!$props.getBooleanProperty($props.NamePropIsCollection))
												($props.getPropertyFormatted($props.NamePropContentLength))
											#end
										</li>
									#end
								#end
							</ul>
						#end	
					#end
					</div>	
				#end
				#if ($withGrade)
					#set ($previousGrades =  $!submission.Properties.getProperty($!submission.Properties.getNamePropSubmissionScaledPreviousGrades()))
					#if ($!previousGrades.length() == 0 )
						#set ($previousGrades =  $!submission.Properties.getProperty($!submission.Properties.getNamePropSubmissionPreviousGrades()))
					#end
					#if ($!previousGrades.length() != 0 )
						<h4 id="toggleGrade" class="toggleAnchor">
							$tlang.getString("gradingsub.pregra")
						</h4>
						<div class="gradecoms  toggledContent">		
							$previousGrades
						</div>
					#end
				#end
				#if ($!assignment.getContent().HonorPledge!=1)
					<p class="checkbox highlightPanel">
						<label for="$name_submission_honor_pledge_yes">
							$tlang.getString("gen.honple2")
						</label>
						#if (!$!canSubmit)
							## for submitted submission not yet returned; or returned but resubmitted submission; or after the close time
							#if ($value_submission_honor_pledge_yes.equals("false"))
								<input id="$name_submission_honor_pledge_yes" type="checkbox" name="$name_submission_honor_pledge_yes" value="true" disabled="disabled" />
							#else
								<input id="$name_submission_honor_pledge_yes" name="$name_submission_honor_pledge_yes" type="checkbox" value="true" disabled="disabled" checked="checked" />
							#end
						#else
							#if ($value_submission_honor_pledge_yes.equals("false"))
								<input id="$name_submission_honor_pledge_yes" type="checkbox" name="$name_submission_honor_pledge_yes" value="true" />
							#else
								<input id="$name_submission_honor_pledge_yes" name="$name_submission_honor_pledge_yes" type="checkbox" value="true" checked="checked" />
							#end					
						#end
						<br />
						$tlang.getString("gen.youmus")
					</p>
				#end
			<div class="act">
				## student role
				#if ($!deleted.equalsIgnoreCase("true"))
					##if the assignment has been deleted, disable the action button
					<input 
						type="button" 
						name="cancel" 
						accesskey="x"
						id="cancel" 
						value="$tlang.getString("gen.don")"
						onclick="document.addSubmissionForm.onsubmit();document.addSubmissionForm.option.value='cancel'; document.addSubmissionForm.submit(); return false;"
					/>
				#else
					#if ($!closeTime && $currentTime.after($!closeTime) || !$allowSubmit)
						<input 
							type="button" 
							name="cancel"
							accesskey="x"
							id="cancel" 
							value="$tlang.getString("gen.don")"
							onclick="document.addSubmissionForm.onsubmit();document.addSubmissionForm.option.value='cancel'; document.addSubmissionForm.submit(); return false;"
						/>
					#else
					#if (!$submitted || ($submitted && !$timeSubmitted) || ($returned && $!timeSubmitted && $!timeReturned && $!timeReturned.after($!timeSubmitted)))
							<input
								type="button"
								class="active"
								#if ($submitted && $!timeSubmitted)
									#set($name=$tlang.getString("resubmit"))
								#else
									#set($name=$tlang.getString("gen.subm3"))
								#end
								name="post"
								accesskey="s"
								id="post" 
								value="$!name"
								onclick="document.addSubmissionForm.onsubmit();showNotif('submitnotif','post','addSubmissionForm'); document.addSubmissionForm.option.value='post'; document.addSubmissionForm.submit(); return false;"
							/>
							<input
								class="disableme" 
								type="button" 
								name="preview" 
								accesskey="v"
								id="preview" 
								value="$tlang.getString("gen.pre")"
								onclick="document.addSubmissionForm.onsubmit();showNotif('submitnotif','preview','addSubmissionForm');document.addSubmissionForm.option.value='preview'; document.addSubmissionForm.submit(); return false;"
							/>
							<input
								class="disableme" 
								type="button" 
								name="save" 
								accesskey="d"
								id="save" 
								value="$tlang.getString("gen.savdra")"
								onclick="document.addSubmissionForm.onsubmit();showNotif('submitnotif','save','addSubmissionForm');document.addSubmissionForm.option.value='save'; document.addSubmissionForm.submit(); return false;"
							/>
							<input 
								class="disableme"
								type="button" 
								name="cancel"
								accesskey="x"
								id="cancel" 
								value="$tlang.getString("gen.can")"
								onclick="document.addSubmissionForm.onsubmit();document.addSubmissionForm.option.value='cancel'; document.addSubmissionForm.submit(); return false;"
							/>
						#else
							<input 
								type="button" 
								name="cancel" 
								accesskey="x"
								id="cancel" 
								value="$tlang.getString("gen.don")"
								onclick="document.addSubmissionForm.onsubmit();document.addSubmissionForm.option.value='cancel'; document.addSubmissionForm.submit(); return false;"
							/>
						#end
					#end
				#end
				<span id="submitnotif" style="visibility:hidden">$tlang.getString("gen.proces")</span>
			</div>
		#else
				#if ($submission.getGradeReleased() && $!submission.FeedbackText && ($submission.FeedbackText.length()>0))
					#set ($text = $submission.FeedbackText)
					#if ($!text)
						<p class="instruction">
							$tlang.getString("gen.orisub2")
						</p>
						<div class="textPanel">$cheffeedbackhelper.escapeAssignmentFeedback($text)</div>
					#end
				#elseif ($!submission.submittedText && ($submission.SubmittedText.length()>0))
					#set ($text = $submission.SubmittedText)
					#if ($!text)
						<div class="textPanel">$cheffeedbackhelper.escapeAssignmentFeedback($text)</div>
					#end
				#end
				## for returned submission, show the instructor comment as well
				#if ($!prevFeedbackText)
					<h5>$tlang.getString("gradingsub.prefeetex")</h5>
					<div class="textPanel">
						$cheffeedbackhelper.showPrevFeedback($cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackText))
					</div>
				#end
				## submitted attachment
				#set ($submittedAttachments = $submission.SubmittedAttachments)
				#set ($size = 0)
				#set ($props = false)
				#foreach ($attachment in $submittedAttachments) 
					#set ($props = $attachment.Properties) 
					#if ($!props)
						#set ($size = $size + 1)
				 #end
				#end
				#if ($size == 0)
					$tlang.getString("gen.noatt")
				#else
					<h5>$tlang.getString("gen.stuatt")</h5>
					<ul class="attachList indnt1">
						#foreach ($attachment in $submittedAttachments) 
							#set ($props = false)
							#set ($props = $attachment.Properties) 
							#if ($!props)
								<li>
									#if ($props.getBooleanProperty($props.NamePropIsCollection))
										<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
									#else
										<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
									#end
									<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
									#if (!$props.getBooleanProperty($props.NamePropIsCollection))
										($props.getPropertyFormatted($props.NamePropContentLength))
									#end
								</li>
							#end
						#end
					</ul>
				#end	
				#if ($withGrade && $submission.getGraded() && $submission.getGradeReleased())
					#if ($submission.getGradeReleased() &&($!submission.FeedbackComment) && ($submission.FeedbackComment.trim().length()>0))
						<h5>$tlang.getString("gen.addinst")</h5>
						<div>$validator.escapeHtmlFormattedText($submission.FeedbackComment)</div>
					#else
					#end
					## for returned submission, show the instructor feedback
					#if ($!prevFeedbackComment && $!prevFeedbackComment.trim().length() > 0)
						<h5>$tlang.getString("gradingsub.prefee")</h5>
						<div class="textPanel">$cheffeedbackhelper.showPrevFeedback($cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackComment))</div>
					#end	
					#set ($size = 0)
					#set ($props = false)
					#set ($feedbackAttachments = $submission.FeedbackAttachments)
					#set ($size = 0)
					#set ($props = false)
					#foreach ($attachment in $feedbackAttachments) 
						#set ($props = $attachment.Properties) 
						#if ($!props)
							#set ($size = $size + 1)
						#end
					#end
					#if ($size == 0)
						##$tlang.getString("gen.noatt")
					#else
						<h5>$tlang.getString("gen.addinst")</h5>
						<ul class="attachList indnt1">
									#foreach ($attachment in $feedbackAttachments) 
										#set ($props = false)
										#set ($props = $attachment.Properties) 
										#if ($!props)
											<li>
												#if ($props.getBooleanProperty($props.NamePropIsCollection))
													<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
												#else
													<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
												#end
												<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
												#if (!$props.getBooleanProperty($props.NamePropIsCollection))
													($props.getPropertyFormatted($props.NamePropContentLength))
												#end
											</li>
										#end
									#end
							</ul>
							#end
					#end
					#if ($withGrade)
						#set ($previousGrades =  $!submission.Properties.getProperty($!submission.Properties.getNamePropSubmissionScaledPreviousGrades()))
						#if ($!previousGrades.length() != 0 )
							<br />$tlang.getString("gradingsub.pregra") $previousGrades
						#else
							#set ($previousGrades =  $!submission.Properties.getProperty($!submission.Properties.getNamePropSubmissionPreviousGrades()))
							#if ($!previousGrades.length() != 0 )

									<br />$tlang.getString("gradingsub.pregra") $previousGrades
							#end
						#end
					#end
			<p class="act">
				<input 
					type="button" 
					name="cancel"
					accesskey="x"
					id="cancel" 
					value="$tlang.getString("gen.don")"
					onclick="document.addSubmissionForm.onsubmit();document.addSubmissionForm.option.value='cancel'; document.addSubmissionForm.submit(); return false;"
				/>
			</p>
		#end
	</form>
	#end
</div>

